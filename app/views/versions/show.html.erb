<% provide :title, "#{@version}" %>

<% provide :toolbox, "<li>#{ link_to 'Update version info', edit_version_path(@version) }</li>".html_safe if can? :edit, @version %>
<% provide :toolbox, "<li>#{ link_to 'Add milestone', new_version_milestone_path(@version) }</li>".html_safe if can? :create, @version %>
<% provide :toolbox, "<li>#{ link_to 'Remove version', version_path(@version), :method => :delete }</li>".html_safe if can? :destroy, @version %>

<% unless @version.codename.nil? %>
  <h1>"<%= @version.codename %>"</h1>
  <h2><%= @version %></h2>
<% else %>
  <h1><%= @version %></h1>
<% end %>
  
  <h3>Overview</h3>
  <div>Total milestones: <%= @version.milestones.count %></div>
  <div>Remaining milestones: <%= active_milestones_for(@version) %></div>
  <%= "<div class=\"past-due\">Milestones past due: #{past_due_milestones_for(@version)}</div>".html_safe if past_due_milestones_for(@version) %>
  
  
  <h3>Milestones</h3>
  <table>
    <thead>
      <tr><td>Name</td><td>Due by</td><td>Completed on</td></tr>
    </thead>
    <tbody>
      <% @version.milestones.sort_by(&:due_by).each do |milestone| %>
      <tr>
        <td <%= 'class="finished"'.html_safe unless milestone.completed_on.nil? %>><%= milestone.name %></td>
        <td <%= 'class="past-due"'.html_safe if milestone.completed_on.nil? && milestone.due_by < Date.today %>><%= milestone.due_by %></td>
        <td><%= milestone.completed_on || '<em>Not completed</em>'.html_safe %></td>
      </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr><td colspan="3"><%= pluralize(@version.milestones.count, 'milestones') %></td></tr>
    </tfoot>
  </table>